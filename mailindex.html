<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EMS</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="assets/plugins/fontawesome-free/css/all.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="assets/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="assets/dist/css/adminlte.min.css">

  <!-- <link rel="stylesheet" href="assets/plugins/fontawesome-free/css/all.min.css"> -->

</head>

<style>
#channel_KWH {
  width: 100%;
  height: 50%;
}
#channel_KWH22 {
  width: 100%;
  max-width:100%;
  height: 500px;
}
#channel_KWH33 {
  width: 100%;
  max-width:100%;
  height: 500px;
}
</style>

<body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">

  <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__wobble" src="" alt="" height="60" width="60">
  </div>

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-dark" style="margin-left: 0;">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <!-- <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li> -->
      <li class="nav-item d-none d-sm-inline-block">
        <a href="login.html" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="index.html" class="nav-link">Monitor view</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="overview.html" class="nav-link">Overview</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="livemeter.html" class="nav-link">Meter Status</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="report.html" class="nav-link">Reports</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="mailindex.html" class="nav-link">Mail</a>
      </li>
    </ul>

    <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="window.history.back()" role="button">
            <i class="fas fa-arrow-left"></i> Back
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="location.reload()" role="button">
            <i class="fas fa-sync-alt"></i> Refresh
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="fullscreen" href="#" role="button">
            <i class="fas fa-expand-arrows-alt"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
            <i class="fas fa-th-large"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
            <img src="images/Aquapharm.jpg" alt="" class="" style="height: 50px; width: 50px; margin-top: -20px;">
          </a>
        </li>
      </ul>
      
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4" style="display: none;">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link">
      <img src="" alt="" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light"><h1><b>EMS</b></h1></span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <!-- <img src="assets/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image"> -->
        </div>
        <div class="info">
          <a href="#" class="d-block"></a>
        </div>
      </div>

      <!-- SidebarSearch Form -->
      <div class="form-inline">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar Menu -->
     
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

 <!-- Main content -->
<section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><b>MAIL INDEX</b></h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body">
              <!-- Form to add new email -->
              <div class="row">
                <div class="col-md-4">
                  <!-- <form id="addEmailForm"> -->
                    <div class="form-group">
                      <label for="email">Email:</label>
                      <input type="email" class="form-control" id="mail_id" required>
                    </div>
                </div>
                <div class="col-md-4">

                    <div class="form-group">
                      <label for="department">Department:</label>
                      <input type="text" class="form-control" id="department" required>
                    </div>
                  </div>

                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary" style="margin-top: 25px; margin-left: 60px;"    id="add_Mail" onclick="addMail()">Add Email</button>
                  </form>
                </div>
              </div>
              <!-- Table for displaying email IDs -->
              <div class="table-responsive"  >
                <table id="example2" class="table table-bordered table-hover">
             
                      <thead class="custom-thead">
                        <tr>                          
                          <th>E-Mail ID</th>
                          <th>Department</th>
                          <th>EDIT/DELETE</th>
                          <!-- <th>DELETE</th> -->
                        </tr>
                      </thead>
                
                  <tbody id="emailTableBody">
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="4"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
  </section>
  <!-- /.content -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="assets/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables  & Plugins -->
<script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="assets/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="assets/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="assets/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="assets/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="assets/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="assets/plugins/jszip/jszip.min.js"></script>
<script src="assets/plugins/pdfmake/pdfmake.min.js"></script>
<script src="assets/plugins/pdfmake/vfs_fonts.js"></script>
<script src="assets/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="assets/plugins/datatables-buttons/js/buttons.print.min.js"></script>
<script src="assets/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
<!-- AdminLTE App -->
<script src="assets/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="assets/dist/js/demo.js"></script>
<!-- Page specific script -->

<!-- amchrts links -->
<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>


<script src="/socket.io/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>


<!-- AdminLTE for demo purposes -->
<script src="assets/dist/js/demo.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="assets/dist/js/pages/dashboard2.js"></script>

<script>
var socket = io();

function addMail() {
  var mail = document.getElementById("mail_id").value;
  var dept = document.getElementById("department").value;

  console.log("onclickdataaaa:::::", mail, dept);
  socket.emit("get_mail_details", mail, dept)

}

socket.emit("delete_mailid", "delete_mailid");


socket.on("delete_data", function (mail_array) {
    console.log("delete_data", mail_array);

    $("#emailTableBody").empty();
    for (var i = 0; i < mail_array.length; i = i + 3) {
        $("#emailTableBody").append("<tr style='font-size: 18px;'><td class='setCenter' id='editEmail" + mail_array[i] + "'>" + mail_array[i + 1] + "</td><td class='setCenter' id='editdept" + mail_array[i] + "'>" + mail_array[i + 2] + "</td><td  class='setCenter'><i style='color:green;font-size: 25px;margin-right: 24px;' id='" + mail_array[i] + "' onclick='editrecordAll(this.id)' class='fa fa-edit'></i><i style='color:blue;font-size: 25px;' id='" + mail_array[i] + "' onclick='deleterecordAll(this)' class='fa fa-trash'></i></td></tr>");
    }
    console.log("ooooo");
});
////////////////////////////////////////////////Delete from database //////////////////////////////////////////////////
    function deleterecordAll(element) {
    var id = element.id; // Get the id of the element
    console.log("deleteid::", id);
    var id_before = id.split('='); // Now you can split it
    var sr_no = id_before[0];
    console.log("sr_no", sr_no);
    setInterval(function () {
            socket.emit("delete_mail_List", sr_no);
            window.location.reload();
        }, 2000)
        swal('Record deleted!', '', 'success');
    }
////////////////////////////////////////////////Delete from database //////////////////////////////////////////////////
////////////////////////////////////////////////Edit from database //////////////////////////////////////////////////
socket.emit("edit_mailid", "edit_mailid");


socket.on("edit_data", function (mail_array) {
    console.log("edit_data", mail_array);

    $("#emailTableBody").empty();
    for (var i = 0; i < mail_array.length; i = i + 3) {
        $("#emailTableBody").append("<tr style='font-size: 18px;'><td class='setCenter' id='editEmail" + mail_array[i] + "'>" + mail_array[i + 1] + "</td><td class='setCenter' id='editdept" + mail_array[i] + "'>" + mail_array[i + 2] + "</td><td  class='setCenter'><i style='color:green;font-size: 25px;margin-right: 24px;' id='" + mail_array[i] + "' onclick='editrecordAll(this.id)' class='fa fa-edit'></i><i style='color:blue;font-size: 25px;' id='" + mail_array[i] + "' onclick='deleterecordAll(this)' class='fa fa-trash'></i></td></tr>");
    }
    console.log("ooooo");
});


function editrecordAll(sr_no) {
    var newMailId = prompt("Enter the new email ID:");
    var newDepartment = prompt("Enter the new department:");
    
    if (newMailId !== null && newDepartment !== null) {
        // Emit the edit event with both the new email ID and department
        socket.emit("edit_mail_List", { sr_no: sr_no, mail_id: newMailId, department: newDepartment });
        
        // Update the table dynamically without page refresh
        $("#editEmail" + sr_no).text(newMailId); // Update email ID
        $("#editdept" + sr_no).text(newDepartment); // Update department
    }
}



// Listen for new email data from the server
socket.on('newEmail', (data) => {
  // Call the addEmail function to add the new email to the table
  addEmail(data.email, data.department);
});
</script>


  <!-- <!-////////////////////////////////////////////////////mailindex end /////////////////////////////////////-  --> 

</body>
</html>
